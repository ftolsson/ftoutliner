

<div id = "main">
	<p class="headline">Welcome to FTOutliner!</p>
	<br<br/>
	This is a plugin for navigating, editing and getting a bird's eye view of your screenplay. You can move scenes around, filter them by colors or characters and cycle through any notes or markers in your script.<br/><br/>
	<strong>If you never used it before,</strong> don't feel overwhelmed! FTOutliner is meant to make your screenwriting life esier. Keep it open next to your screenplay as you write, and I'm sure you'll gradually find your own best way to use it.<br/><br/>
	<strong>If you have been using FTOutliner before</strong> and wonder what's new in this version, here are the latest changes:
	<div id="changelog"></div>
	<strong>That's all!</strong> Let's go writing, both of us!<br/><br/><br/>
		<!--hr-->
		<ul>
		<!--strong><br/>Behavior Settings</strong><br/-->
		<li id="changeThis" style="width: max-content; margin-left: auto; margin-right: auto; padding-right: 40px"> 
			<input id="buttonFor-dontShowWelcomeWindowFor" + userDefault.ftoutlinerVersion type="checkbox">
			<label for="buttonFor-dontShowWelcomeWindowFor" + userDefault.ftoutlinerVersion>Don't show this dialog again for this version<span class="shortcut" style="float:right"></span></label>
			<!--span class="explanation">Unless there's something new to say that's really important.<br/>In which case sure, fine, go ahead.</span-->
		</li>
		</ul>

	<p><br/></p>
	<div class="dialogBottomButtonRow">
		<!-- <button class="generalButtonStyle" onclick="for (butn of $$('#advancedSettings input')){if(butn.checked){butn.click()}}">Revert to defaults</button> -->
		<button class="generalButtonStyle" onclick="Beat.call('Beat.custom.closeSecondWindow()')">Close</button>
	</div>
</div>

<script>

	//Dynamically adding version number to checkbox to automatically reset it when new version is released:

	window.addEventListener('load', function () {

		Beat.callAndWait(() => {
			let ftoutlinerVersion = Beat.getUserDefault("ftoutlinerVersion")
			return(ftoutlinerVersion)
		})
		.then(
        	response => {
				
				ftoutlinerVersion = response.replace(/\./g, "")
				
				let listItem = document.getElementById("changeThis")
					listItem.onclick = function(){
						toggleThis('dontShowWelcomeWindowFor' + ftoutlinerVersion, 'buttonFor-dontShowWelcomeWindowFor' + ftoutlinerVersion)
					}
					listItem.querySelector("input").id = "buttonFor-dontShowWelcomeWindowFor" + ftoutlinerVersion
					listItem.querySelector("label").setAttribute("for", "buttonFor-dontShowWelcomeWindowFor" + ftoutlinerVersion)
		},
        	error => { console.log("Error retrieving userDefault") }
    	)

		Beat.callAndWait(() => {
			let changelog = Beat.assetAsString("changelog")
			return(changelog)
		})
		.then(
        	response => {
				
				changelog = response
				document.querySelector("#changelog").innerHTML = changelog
				
		},
        	error => { console.log("Error retrieving changelog") }
    	)

	})

	//STARTUP SEQUENCE:

	var userDefault = {}
	var documentSetting = {}
    
    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getUserDefault("ftoutlinerObject")
        return(ftoutlinerObject)
    })
    .then(
        response => { userDefault = JSON.parse(response)
			
			//Apply the correct checkbox states on open:
			for ([key, value] of Object.entries(userDefault)){					
					let button = document.getElementById("buttonFor-" + key)
						if(button){ 
							if(value == true) button.setAttribute("checked", true) 
						}
				}
		},
        error => { console.log("Error retrieving userDefault") }
    )

    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getDocumentSetting("ftoutlinerObject")
        return ftoutlinerObject
    	})
		.then(
			response => { documentSetting = JSON.parse(response)
		
				//Apply the correct checkbox states on open:
					for ([key, value] of Object.entries(documentSetting)){					
						let button = document.getElementById("buttonFor-" + key)
							if(button){ 
								if(value == true) button.setAttribute("checked", true) 
							}
					}
			},
			error => { console.log("Error retrieving documentSetting") }
		)


	//FUNCTIONS:

	function toggleThis(settingName, settingButton, invertSelection){

		userDefault[settingName] = document.getElementById("buttonFor-" + settingName).checked
		
		let valueAsJSON = JSON.stringify(userDefault[settingName])
			Beat.call(`	Beat.custom.sendToMain("${settingName}", ${valueAsJSON}, "userDefault") `)

	}


</script>

<style>

    :root{

        --menu-background: hsla(25, 64%, 96%, 1.00);/* rgb(240, 240, 240); /*was 232*/
	    --menu-border-color: #c1c1c1;
	    --menu-color: black; /*rgb(233,233,233);*/
	    --menu-hover-color: #027aff;

    }

    @media (prefers-color-scheme: dark) {

        :root{

            --menu-background: hsla(25, 10%, 24%, 1.00);
            --menu-border-color: rgb(81,81,81);
            --menu-color: rgb(233,233,233);

            --inkOnPaper: 0, 0%, 100%;
            --paperBehindInk: 0, 0%, 0%;

        }
    }

    body{

        background-color: var(--menu-background);
		color: var(--menu-color);

        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: 14px;
        font-weight: normal;
        line-height: 20px;

		padding: 20px 40px 20px 40px;

    }

	#changelog{

		white-space: pre-wrap;

		margin: 20px 0px 20px 0px;

		background-color: white;
		padding: 30px;
		border-radius: 4px;
		border: 1px solid var(--menu-border-color);

		height: 200px;
		overflow-y: scroll;

		box-shadow: inset 2px 2px 3px rgba(0, 0, 0, 0.15);
	}

	.headline {

		font-size: 32px;
		font-weight: 800;
		line-height: 38px;
		margin: 20px 0px 20px 0px;
		display: block;

		margin-bottom: 20px;

	}

    li {

        list-style-type: none;
        padding-top: 3px;
		padding-left: 20px;
    }

	.shortcut {

		display: none;

	}

	.explanation {

		font-size: 11px;
		line-height: 14px;
		margin-left: 21px;
		margin-top: -2px;
		display: block;

		font-style: italic;
		opacity: 60%;

	}

	label:hover .shortcut {

		display: inline;

	}

	.dialogBottomButtonRow {

		position: absolute;
		bottom: 20px;
		right: 20px;

	}

	button{

		font-size: 13px;

	}

	button:hover{

		border: initial !important;
		border-radius: 4px !important; 
		padding: 2px 8px 3px 8px;
		border-radius: inherit !important; 
		background-color: var(--menu-hover-color);
		color: white;
		/* pointer-events: none; */

	}

	hr {

		opacity: 50%;
		margin: 0 40px;
		mix-blend-mode: multiply;

	}

	ul {

		margin-top: 0px;
		margin-bottom: 0px;

	}


</style>
