<p class="headline">Welcome to FTOutliner!</p>
<div id = "main">
This seems to be your first time opening this version, so here are some quick words before you go ahead.<br/><br/>
<strong>If you've never used FTOutliner before,</strong><br/>
first of all: Welcome! This is a plugin for navigating, editing and getting a bird's eye view of your screenplay. Don't be overwhelmed — FToutliner is meant to make your screenwriting life esier. Just keep it open next to your screenplay as you write. Gradually, you'll find your own ways to use it.<br/><br/>
<strong>This version has been rewritten. A lot.</strong><br/>
That's a good thing, of course. FTOutliner is written by a screenwriter, not a coder. But over time, it appears old dogs can learn too. <br/>
This is a version that aims to fix a lot of my newbie mistakes. But in doing so I'm bound to introduce new ones. Because oh well. And on that note:
<br/><br/>
<strong>Please report any bugs or quirks you run into.</strong><br/>
Some stuff is still being worked on. Some is not, but ought to be. And for that to happen I depend on your help.
<br/><br/>
<!--li style="padding-right: 40px"-->
	<i>in the Settings menu, there is now a menu itemo to <strong>&quot;Report an issue&quot;</strong>, which launches a browser window with FTOutliner's GitHub issues page. Please use it, and tell me what you encounter! (You'll need a user account to post, but it's free to sign up)
	</i><br/><br/>
<!--/li-->
<!--strong>What has changed?</strong><br/>
If you have used FTOutliner before, most will look the same. There are a couple of small, new features, but most changes are internal to make the plugin more stable. If you're curious, check the changelog from the Settings menu.
<br/>
If you haven't, then once again welcome. Don't feel overwhelmed — FToutliner is meant to make your screenwriting life esier. Just keep it open next to your screenplay as you write — hopefully, you'll gradually find your own ways to use it.
<br/><br/-->
<strong>Finally,</strong><br/>
That's about it. I've taken enough of your time already. Let's go writing, both of us!<br/><br/>
	<!--hr-->
	<ul>
	<!--strong><br/>Behavior Settings</strong><br/-->
	<li id="changeThis" style="width: max-content; margin-left: auto; margin-right: auto; padding-right: 40px"> 
		<input id="buttonFor-dontShowWelcomeWindowFor" + userDefault.ftoutlinerVersion type="checkbox">
		<label for="buttonFor-dontShowWelcomeWindowFor" + userDefault.ftoutlinerVersion>Enough with this dialog already, don't ever show it again!<span class="shortcut" style="float:right"></span></label>
		<span class="explanation">Unless there's something new to say that's really really important.<br/>In which case sure, fine, go ahead.</span>
	</li>
	</ul>

	<p><br/></p>
	<div class="dialogBottomButtonRow">
		<!-- <button class="generalButtonStyle" onclick="for (butn of $$('#advancedSettings input')){if(butn.checked){butn.click()}}">Revert to defaults</button> -->
		<button class="generalButtonStyle" onclick="Beat.call('Beat.custom.closeSecondWindow()')">Close</button>
	</div>
</div>

<script>

	//Dynamically adding version number to checkbox to automatically reset it when new version is released:

	window.addEventListener('load', function () {

		Beat.callAndWait(() => {
			let ftoutlinerVersion = Beat.getUserDefault("ftoutlinerVersion")
			return(ftoutlinerVersion)
		})
		.then(
        	response => {
				
				ftoutlinerVersion = response.replace(/\./g, "")
				
				let listItem = document.getElementById("changeThis")
					listItem.onclick = function(){
						toggleThis('dontShowWelcomeWindowFor' + ftoutlinerVersion, 'buttonFor-dontShowWelcomeWindowFor' + ftoutlinerVersion)
					}
					listItem.querySelector("input").id = "buttonFor-dontShowWelcomeWindowFor" + ftoutlinerVersion
					listItem.querySelector("label").setAttribute("for", "buttonFor-dontShowWelcomeWindowFor" + ftoutlinerVersion)
		},
        	error => { console.log("Error retrieving userDefault") }
    	)
	})

	//STARTUP SEQUENCE:

	var userDefault = {}
	var documentSetting = {}
    
    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getUserDefault("ftoutlinerObject")
        return(ftoutlinerObject)
    })
    .then(
        response => { userDefault = JSON.parse(response)
			
			//Apply the correct checkbox states on open:
			for ([key, value] of Object.entries(userDefault)){					
					let button = document.getElementById("buttonFor-" + key)
						if(button){ 
							if(value == true) button.setAttribute("checked", true) 
						}
				}
		},
        error => { console.log("Error retrieving userDefault") }
    )

    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getDocumentSetting("ftoutlinerObject")
        return ftoutlinerObject
    	})
		.then(
			response => { documentSetting = JSON.parse(response)
		
				//Apply the correct checkbox states on open:
					for ([key, value] of Object.entries(documentSetting)){					
						let button = document.getElementById("buttonFor-" + key)
							if(button){ 
								if(value == true) button.setAttribute("checked", true) 
							}
					}
			},
			error => { console.log("Error retrieving documentSetting") }
		)


	//FUNCTIONS:

	function toggleThis(settingName, settingButton, invertSelection){

		userDefault[settingName] = document.getElementById("buttonFor-" + settingName).checked
		
		let valueAsJSON = JSON.stringify(userDefault[settingName])
			Beat.call(`	Beat.custom.sendToMain("${settingName}", ${valueAsJSON}, "userDefault") `)

	}


</script>

<style>

    :root{

        --menu-background: hsla(25, 64%, 96%, 1.00);/* rgb(240, 240, 240); /*was 232*/
	    --menu-border-color: #c1c1c1;
	    --menu-color: black; /*rgb(233,233,233);*/
	    --menu-hover-color: #027aff;

    }

    @media (prefers-color-scheme: dark) {

        :root{

            --menu-background: hsla(25, 10%, 24%, 1.00);
            --menu-border-color: rgb(81,81,81);
            --menu-color: rgb(233,233,233);

            --inkOnPaper: 0, 0%, 100%;
            --paperBehindInk: 0, 0%, 0%;

        }
    }

    body{

        background-color: var(--menu-background);
		color: var(--menu-color);

        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: 14px;
        font-weight: normal;
        line-height: 20px;

		padding: 20px 40px 20px 40px;

    }

	.headline {

		font-size: 32px;
		font-weight: 800;
		line-height: 38px;
		margin: 20px 0px 20px 0px;
		display: block;

	}

    li {

        list-style-type: none;
        padding-top: 3px;
		padding-left: 20px;
    }

	.shortcut {

		display: none;

	}

	.explanation {

		font-size: 11px;
		line-height: 14px;
		margin-left: 21px;
		margin-top: -2px;
		display: block;

		font-style: italic;
		opacity: 60%;

	}

	label:hover .shortcut {

		display: inline;

	}

	.dialogBottomButtonRow {

		position: absolute;
		bottom: 20px;
		right: 20px;

	}

	button{

		font-size: 13px;

	}

	button:hover{

		border: inherit !important;
		border-radius: inherit !important; 
		background-color: var(--menu-hover-color);
		color: white;
		/* pointer-events: none; */

	}

	hr {

		opacity: 50%;
		margin: 0 40px;
		mix-blend-mode: multiply;

	}

	ul {

		margin-top: 0px;
		margin-bottom: 0px;

	}


</style>
