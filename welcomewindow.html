<p class="headline">Welcome to FTOutliner!</p>
<div id = "main">
	
		It seems this your first time opening this version, so here are some quick words before you go ahead.<br/><br/>
		<strong>• FTOutliner is a work in progress. Aren't we all.</strong><br/>&nbsp;
		First of all, I'm not a coder. I'm a screenwriter. One who couldn't find a visual outlining tool that made me happy. And so, long story short, when Beat allowed external plugins, I made this for myself. As a side effect, I also made it for you.<br/>
		Over the couple of years that FTOutliner has existed, I've become marginally less sucky at coding. For that reason, I'm currently trying to rewrite the entire codebase to eliminate the worst beginner mistakes. But:
		<br/><br/>
		<strong>• Consider this a pre-release version.</strong><br/>&nbsp;
		The version you are using didn't come through Beat's plugin manager mechanism, but was downladed off of my GitHub repo and installed manually by you.<br/>
		This means some stuff will be missing. For others, I'm hoping to learn from other people's usage what doesn't work as intended. That's where you come in:
		<br/><br/>
		<strong>• Bugs will happen. Please report them.</strong><br/>&nbsp;
		I am slowly transforming the entire code from the tangled spaghetti that remains from my first coding steps, into what is hopefully at least some shorter, less clunky, kind of pasta.
		<br/><br/>
		For that reason, <strong>there is a new menu item in the Settings Menu</strong> that launches a small browser window with my gitHub issues page. Please use it, and tell me whatever problems you encounter! (You need a user account to post, but it's free to sign up)
		<br/><br/>
		<strong>• What has changed?</strong><br/>&nbsp;
		If you have used FTOutliner before, most will look the same. There are a couple of small, new features, but this version is mostly about getting the plugin much more reliable and stable.<br/>
		If you're curious, do check out the changlog in the settings menu.
		<br/>If you have not used FTOutliner before, then once again welcome. I hope you don't feel overwhelmed — this plugin is meant to make your screenwriting life esier. No need to learn anything until you feel ready — just keep writing as normal and keep FTOtliner open next your screenplay, and you will hopefully gradually get a hang of what it can do for you.
		<br/><br/>
		<strong>• Finally</strong><br/>&nbsp;
		That's about it, I think. I've taken enough of your time already. Let's go writing, both of us!<br/><br/>
	<!--hr-->
	<ul>
	<!--strong><br/>Behavior Settings</strong><br/-->&nbsp;
	<li onclick="toggleThis('neverShowWelcomeWindowAgain', 'buttonFor-neverShowWelcomeWindowAgain')"> 
		<input id="buttonFor-neverShowWelcomeWindowAgain" type="checkbox">
		<label for="buttonFor-neverShowWelcomeWindowAgain">Don't ever show this dialog again, goddamit!<span class="shortcut" style="float:right"></span></label>
		<span class="explanation">Unless there's something new to say that's really really important.<br/>In which case sure, fine, go ahead.</span>
	</li>
	<!--li onclick="toggleThis('clickingSelectsInEditor', 'buttonFor-clickingSelectsInEditor')">
		<input id="buttonFor-clickingSelectsInEditor" type="checkbox">
		<label for="buttonFor-clickingSelectsInEditor">Clicking scenes in FTOutliner selects text in main editor<span class="shortcut" style="float:right"></span></label>
		<span class="explanation">When OFF, the same can be temporarily achieved with ctrl+alt+cmd+click.</span>
	</li>
	<br/>
	<li  onclick="toggleThis('warningsAreOn', 'buttonFor-warningsAreOn', true)">
		<input id="buttonFor-warningsAreOn" type="checkbox">
		<label for="buttonFor-warningsAreOn">Disable Warning Messages<span class="shortcut" style="float:right">^P</span></label>
	</li>
	<li  onclick="toggleThis('realTimeIsOn', 'buttonFor-realTimeIsOn', true)">
		<input id="buttonFor-realTimeIsOn" type="checkbox">
		<label for="buttonFor-realTimeIsOn">Disable Real Time Updating	<span class="shortcut" style="float:right">^P</span></label><br/>
		<class="explanation">This is generally not recommended</class>
	</li-->
	</ul>

	<p><br/></p>
	<div class="dialogBottomButtonRow">
		<!-- <button class="generalButtonStyle" onclick="for (butn of $$('#advancedSettings input')){if(butn.checked){butn.click()}}">Revert to defaults</button> -->
		<button class="generalButtonStyle" onclick="Beat.call('Beat.custom.closeSecondWindow()')">Close</button>
	</div>
</div>

<script>

	//STARTUP SEQUENCE:

	var userDefault = {}
	var documentSetting = {}
    
    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getUserDefault("ftoutlinerObject")
        return(ftoutlinerObject)
    })
    .then(
        response => { userDefault = JSON.parse(response)
			
			//Apply the correct checkbox states on open:
			for ([key, value] of Object.entries(userDefault)){					
					let button = document.getElementById("buttonFor-" + key)
						if(button){ 
							if(value == true) button.setAttribute("checked", true) 
						}
				}
		},
        error => { console.log("Error retrieving userDefault") }
    )

    Beat.callAndWait(() => {
        let ftoutlinerObject = Beat.getDocumentSetting("ftoutlinerObject")
        return ftoutlinerObject
    	})
		.then(
			response => { documentSetting = JSON.parse(response)
		
				//Apply the correct checkbox states on open:
					for ([key, value] of Object.entries(documentSetting)){					
						let button = document.getElementById("buttonFor-" + key)
							if(button){ 
								if(value == true) button.setAttribute("checked", true) 
							}
					}
			},
			error => { console.log("Error retrieving documentSetting") }
		)


	//FUNCTIONS:

	function toggleThis(settingName, settingButton, invertSelection){

		userDefault[settingName] = document.getElementById("buttonFor-" + settingName).checked

		let valueAsJSON = JSON.stringify(userDefault[settingName])
			Beat.call(`	Beat.custom.sendToMain("${settingName}", ${valueAsJSON}, "userDefault") `)

	}


</script>

<style>

    :root{

        --menu-background: hsla(25, 64%, 96%, 1.00);/* rgb(240, 240, 240); /*was 232*/
	    --menu-border-color: #c1c1c1;
	    --menu-color: black; /*rgb(233,233,233);*/
	    --menu-hover-color: #027aff;

    }

    @media (prefers-color-scheme: dark) {

        :root{

            --menu-background: hsla(25, 10%, 24%, 1.00);
            --menu-border-color: rgb(81,81,81);
            --menu-color: rgb(233,233,233);

            --inkOnPaper: 0, 0%, 100%;
            --paperBehindInk: 0, 0%, 0%;

        }
    }

    body{

        background-color: var(--menu-background);
		color: var(--menu-color);

        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: 13px;
        font-weight: normal;
        line-height: 18px;

    }

	.headline {

		font-size: 24px;
		font-weight: 800;
		line-height: 28px;
		margin: 20px 0px 20px 0px;
		display: block;

	}

    li {

        list-style-type: none;
        padding-top: 3px;
		padding-left: 20px;
    }

	.shortcut {

		display: none;

	}

	.explanation {

		font-size: 11px;
		line-height: 14px;
		margin-left: 40px;
		margin-top: -2px;
		display: block;

		font-style: italic;
		opacity: 60%;

	}

	label:hover .shortcut {

		display: inline;

	}

	.dialogBottomButtonRow {

		position: absolute;
		bottom: 20px;
		right: 20px;

	}

	button{

		font-size: 13px;

	}

	button:hover{

		border: inherit !important;
		border-radius: inherit !important; 
		background-color: var(--menu-hover-color);
		color: white;
		/* pointer-events: none; */

	}

	hr {

		opacity: 50%;
		margin: 0 40px;
		mix-blend-mode: multiply;

	}

	ul {

		margin-top: 0px;
		margin-bottom: 0px;

	}


</style>
